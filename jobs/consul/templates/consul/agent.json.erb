{
  "data_dir": "/var/vcap/store/consul",
  "ui_dir": "/var/vcap/packages/consul-ui",
  "node_name": "<%= spec.deployment %>-<%= name %>-<%= index %>",
  <% if_p("consul.servers") do |servers| %>
  "server": <%= p("consul.server") %>,
  "start_join": <%= servers.to_json %>,
  <% end.else do %>
  "bootstrap": true,
  "server": true,
  <% end %>

  "bind_addr": "0.0.0.0",
  "client_addr": "0.0.0.0",
  "ports": {
    "dns": 53
  },
  <% if (networks = spec.networks.methods(false)) && dns = spec.networks.send(networks.first).dns %>
  "recursor": "<%= dns.first %>",
  <% else %>
  "recursor": "<%= `grep nameserver /etc/resolv.conf | tail -n 1 | awk '{ print $2 }'`.strip %>",
  <% end %>
  "domain": "consul",
  "leave_on_terminate": false,
  "log_level": "INFO"
}
